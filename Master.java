// > encryptedSignature: /K9vrVVM9Dmujjl0svG1wngKzJpUjLOkoghC43dQ1zxSttwiqeDNTQ4lWUnRdLUnFP8sEbyaZ0sJHxa6kFr6Tyi82wwbAUAiZKa1T+0OMIFwwgAM3bC5YiAmySY6dikC2XCw0ZNWIJWpoXR2QPGY8YsVov8+P7cflAf8lFObaRqpGiJDLL0a5Z6eWO8JH5jzGG+/YR0TYCA6zj//WJvEV2j3TfSo5WslO2+SZz1iELNnREVyXtJ4TR3kIqmZwWaTR1ytiWxkRxl4sQhtbvuuBaprmdWg3HDXo9eusTrXhmGAQ8CFz5+g9SFY3NTXjS/BrXVtUBVv40xsD8zNqEOfPzcVNQGQXnz2+6qFH6g/2p02/1JFWRjVPaZJ2WYqOzwj8shJGOD9hoS7r8/sFvgQnXw8KVWLqgTX+ji+8TOtjKxpzkFyLOz5+GZaBw5Hzylzv571XZnkgL9eWiPVIi6c5bLv1qSkTGAgqYJq572dgB54IVKUIe6maDDfHZvfzkxiKtU1O5a1927nClTO0uYwGObXGSmt9qxyaYrLgptVCACqf+dggZzu0/lSCmBsz3Fz79lkPH783ILy0JmFaF9rM2JWOFg62IHrfpoXdCXPA1+DuR/btvVCUhkvW8T0Wj5I9FWO9oU48JEpu2+GVnKYYxLqtdspqgr261kQNYQeFk1x4hfMOY9D6W1UVK+PNqKZ
// > encryptedAESKey: oDVjASU5AOievA3ipRH9rTTNNRGbtT7Agdyon/44nc4RQVIDuxIqhmNGZ5HWEEgsiqtmArVsq9BRiOj1V7QOjOEgZ/smBXhtwC9P5GD9StR3wmmVa0U8eANUVviPiUdjXZcK30qDaocnwqu5AyI1qhMX3RIpidNcxqhq/IaUAwsh4eRRRnhs0vGKatLhja2l4MkOXnURxaVx9r9XWE7dXVqqIWyykfI8/N2hh8v0TYwjjAd+Y1l8FK1rJzfC5jvsM+v7gSeN02CcWFPaK/yMktUUG5MzaJyiTg+puMRAXuZv24x/U4Ai4YSbTKmdzXCltNPK2a3viA5VvamUjsOTvhuUgS0SyV+MEFty4VRGzhCNXuT76UTbmu6AXTf/7PH07Ah8McOt3Z4rsbhJilAta+PBcHiK5wzjYpsY2Hb87yTCs9EK8oYnMJlyBAZoRiBgt/9HMq6uqMqtfSLXradOZ5ikEWgf1GzV+okSUXKYBGhgvIliS9lVzQgaceAA9rOg
// > encryptedData: sBPGtVlFQlNS7kAktflK7aD+vH/XJwPzxsNH4rVyVn0=
// > encryptedPublicKeyClient: 72hZ4BaTDiUDj8CYFdGj1na/GuWz+8OvKL8R5pG3LWWJDumcX2L+1k6bWLjJnwiXg0zgzD6pnDkIXKGh1kvqv1hmEPEuZdHD5oDbyPtMpGxBmaBNR+mxtfqv6rWfpfePVRX8NN4+cK/fLFjUZBGxTuqr8lZUMzjyTY2O1Js2Qc7L+SjHfAfDkLCVr80M3nys6555eTkdd47q1EcyEZDY20h1bo5qoLefdEwBKW18HW+sBm4A9VZ8WOnBbzEXusKzlpbKy/7bEZT+zhojAa31a0LJnn31DqCFMwQqYE52bONeWU+NMXlk8XPTWTeCiHh8zoLidd7FRQc2+eYFm5tRqTFUGxvzNfLgS6GNJPyfnV7vbX0/YYs3MklkpQ0HLHe/l2bK/W5llNuE/T6M+Zik1zdevtXIxYhhP+GbnnahhGIkTDtmhk1Xr9LLZ//pmWYc42DLA7ddVwyeAAki3Eih6R2nQ7WXdcTh2hfCuPHVTUH9GWK8cEZ4Mh5qKAjeMuahRLpuKLh1wScRPdS7wpIc0VaGNyjmQv5RyaugFw4B2TqMPd0/wemUsfxWc2f79vPN590u/vtJJOXauyzG8C8CXAJo2ASOkssQmT0mJt3d87Y2+hvVaeIlhIhyQPQ6bhZoSSsGLdI6f26wV0Au6NxU03uI9wOhzkDX94y6IOqQB1d0QTMqkYTV7q+yS4vivdzT1wJEKedUyWMCJ2o5WOzS6+R3bbVbw1Vr5kCN3uRzEE8cZ6U7YT6/AHAyhNBcbV1L

// > Decrypting...
// > MasterKeyPrivate: sun.security.rsa.RSAPrivateCrtKeyImpl@3863436e
// > Chave AES descriptografada
// > Assinatura descriptografada: B9hlon2NNfw2NqEyo5YlMlZED+mcy2SbYKGRzzomFrlHX4BVmZSbQ7qxz7EO/EQ0J+I1Y/9BUx+aifPUoDI98EcOKJlLiznjXlhNFh4x//qurTi2AY5IY3ZDQPuxlLDOCIdzYsxbKD52Hc+kYlSJfGB8sOrH9trcXWmanKQN1u6X514dFHg7MCvc6lLA5RdpsEtSapd348zVsd2qjABrDdXS9f3Jsk8OnUDtsJ4qNLbOcC1DPnw9glItfXCWK2vHeblhYtn9wQB88p6ui4uu+JkVJ9rwuretfwI5Mh8s6El31TU7+idUl2gOY+EEfEVCjZ8rLB2zcJ+Tlq9KGnJqLlTcmfAkQRY7zvA90zTVta+6mMXEaoW50d3tjbWP/Q2gWtIA0P1nte4917AxHubzgM/YRzuwNX8xPumCPZwlFQegekId958zruKfEC1X7tyLST6a+yb5KIff1MZTQDTky5dL9iptlVpA8ZkSb3aQkqsE2TS1HlLmGA52d02iJz5H
// > Dados descriptografados: Informação confidencial
// > Verificação de assinatura: true
    
import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;
import java.security.*;
import java.util.Base64;
import java.security.spec.X509EncodedKeySpec;
import java.security.spec.PKCS8EncodedKeySpec;


public class Main {
    static KeyPair rsaMasterKeyPair;
    static PublicKey publicKeyMaster;
    static PrivateKey privateKeyMaster;

    static {
        try {
            // Chave RSA master fornecida em Base64 (em um ambiente real, isso seria uma chave real
            String base64MasterPublicKey = "MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEArLA9rcHRjIG2vNTJmS3zMBgYEkuJMZCrpRUCstBK48Uwdp+1zNxxj81e/XLayN8dD8qNIusWckgyUGDTM4LNv+XdKCVgQaDV0jOeIfJqYFK6cPGf2UsDfcWUwpNi/UChv8HD9QI+qglxumYJuY/ttaOrxMUEhnIcnBMgcHb3P+dlsx1VrNfz3oh1UwqrYVglgy1w0sNeNVvOLIjuxbDPnq2wh5dnC+GogxXdB4TXQdeXzOB8gp3Cbc4CW9aycIRnyrrV9ywBaosulgUKwDvtHXk8YjhnyNyviwnoRA4TLnraFTET/BuqaR9sJ1FJ85UNGF+ElAp0u4e354NvPId0oaamaQhGL8xL3aAJgOCmto3xi5Tar7OGJ5WTGzxtAmOcqps3skXFYVcM9KFy19oFymTHkvu556sP648zSTr+jXGO+a1A7SXWv2cEpv3RrqOR8+UQkKRl9ldxKGZ8ePQ4m7etzFxuljYJl08k77q41s9a+HFdYa7qn9Rz+o5OrsG7AgMBAAE=");
            String base64MasterPrivateKey = "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");
            // Convertendo as chaves de Base64 para Key objects
            byte[] publicKeyBytes = Base64.getDecoder().decode(base64MasterPublicKey);
            byte[] privateKeyBytes = Base64.getDecoder().decode(base64MasterPrivateKey);
            KeyFactory keyFactory = KeyFactory.getInstance("RSA");

            publicKeyMaster = keyFactory.generatePublic(new X509EncodedKeySpec(publicKeyBytes));
            privateKeyMaster = keyFactory.generatePrivate(new PKCS8EncodedKeySpec(privateKeyBytes));

        
        } catch (Exception e) {
            e.printStackTrace();
            throw new RuntimeException("Erro ao inicializar as chaves RSA");
        }
    }
    public static KeyPair generateRSAKey() throws Exception {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(3072);
        return keyPairGenerator.generateKeyPair();
    }

    public static SecretKey generateAESKey() throws Exception {
        KeyGenerator keyGenerator = KeyGenerator.getInstance("AES");
        keyGenerator.init(256);
        return keyGenerator.generateKey();
    }
    public static boolean verifySignature(byte[] data, String signatureStr, PublicKey publicKey) throws Exception {
        Signature signature = Signature.getInstance("SHA256withRSA");
        signature.initVerify(publicKey);
        signature.update(data);
        byte[] signatureBytes = Base64.getDecoder().decode(signatureStr);
        return signature.verify(signatureBytes);
    }
    

    public static String encryptRSA(SecretKey aesKey, PublicKey rsaPublicKey) throws Exception {
        Cipher cipher = Cipher.getInstance("RSA/ECB/OAEPWithSHA-256AndMGF1Padding");
        cipher.init(Cipher.ENCRYPT_MODE, rsaPublicKey);
        byte[] encryptedAESKey = cipher.doFinal(aesKey.getEncoded());
        return Base64.getEncoder().encodeToString(encryptedAESKey);
    }

    public static SecretKey decryptRSA(String encryptedAESKey, PrivateKey rsaPrivateKey) throws Exception {
        Cipher cipher = Cipher.getInstance("RSA/ECB/OAEPWithSHA-256AndMGF1Padding");
        cipher.init(Cipher.DECRYPT_MODE, rsaPrivateKey);
        byte[] decodedEncryptedAESKey = Base64.getDecoder().decode(encryptedAESKey);
        byte[] decryptedAESKey = cipher.doFinal(decodedEncryptedAESKey);
        return new SecretKeySpec(decryptedAESKey, "AES");
    }
    public static void print(String text) {
        System.out.println(text);
    }

    public static String encryptAES(String data, SecretKey key) throws Exception {
        Cipher cipher = Cipher.getInstance("AES");
        cipher.init(Cipher.ENCRYPT_MODE, key);
        byte[] encryptedData = cipher.doFinal(data.getBytes());
        return Base64.getEncoder().encodeToString(encryptedData);
    }

    public static String decryptAES(String data, SecretKey key) throws Exception {
        Cipher cipher = Cipher.getInstance("AES");
        cipher.init(Cipher.DECRYPT_MODE, key);
        byte[] decodedData = Base64.getDecoder().decode(data);
        byte[] decryptedData = cipher.doFinal(decodedData);
        return new String(decryptedData);
    }

    public static void main(String[] args) throws Exception {
        
        String input = "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");
        String[] parts = input.split(",");
        
        String encryptedSignature = parts[0];
        String encryptedAESKey = parts[1];
        String encryptedData = parts[2];
        String encryptedPublicKeyClient = parts[3];

    
        print(" > encryptedSignature: " + encryptedSignature);
        print(" > encryptedAESKey: " + encryptedAESKey);
        print(" > encryptedData: " + encryptedData);
        print(" > encryptedPublicKeyClient: " + encryptedPublicKeyClient);
        print("\n > Decrypting...");
        print(" > MasterKeyPrivate: " + privateKeyMaster);
        
        SecretKey decryptedAESKey = decryptRSA(encryptedAESKey, privateKeyMaster);
        print(" > Chave AES descriptografada");

        // Descriptografar a chave pública do cliente com AES
        String decryptedPublicKeyClient = decryptAES(encryptedPublicKeyClient, decryptedAESKey);
        byte[] clientKeyBytes = Base64.getDecoder().decode(decryptedPublicKeyClient);
        KeyFactory keyFactory = KeyFactory.getInstance("RSA");
        PublicKey pclientKeyMaster = keyFactory.generatePublic(new X509EncodedKeySpec(clientKeyBytes));

        // Descriptografar a assinatura com AES
        String decryptedSignature = decryptAES(encryptedSignature, decryptedAESKey);
        print(" > Assinatura descriptografada: " + decryptedSignature);

        // Descriptografar os dados com AES
        String decryptedData = decryptAES(encryptedData, decryptedAESKey);
        print(" > Dados descriptografados: " + decryptedData);

        // Verificar assinatura
        boolean isSignatureValid = verifySignature(decryptedData.getBytes(), decryptedSignature, pclientKeyMaster);
        print(" > Verificação de assinatura: " + isSignatureValid);
        
    }
}
