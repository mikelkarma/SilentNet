// > Assinatura gerada: B9hlon2NNfw2NqEyo5YlMlZED+mcy2SbYKGRzzomFrlHX4BVmZSbQ7qxz7EO/EQ0J+I1Y/9BUx+aifPUoDI98EcOKJlLiznjXlhNFh4x//qurTi2AY5IY3ZDQPuxlLDOCIdzYsxbKD52Hc+kYlSJfGB8sOrH9trcXWmanKQN1u6X514dFHg7MCvc6lLA5RdpsEtSapd348zVsd2qjABrDdXS9f3Jsk8OnUDtsJ4qNLbOcC1DPnw9glItfXCWK2vHeblhYtn9wQB88p6ui4uu+JkVJ9rwuretfwI5Mh8s6El31TU7+idUl2gOY+EEfEVCjZ8rLB2zcJ+Tlq9KGnJqLlTcmfAkQRY7zvA90zTVta+6mMXEaoW50d3tjbWP/Q2gWtIA0P1nte4917AxHubzgM/YRzuwNX8xPumCPZwlFQegekId958zruKfEC1X7tyLST6a+yb5KIff1MZTQDTky5dL9iptlVpA8ZkSb3aQkqsE2TS1HlLmGA52d02iJz5H
// > Chave AES gerada: xJoeU2If7MpVDel/bW9nCmujFbdih1gBSkHM7uYy8nI=
// > Dados criptografados com AES: sBPGtVlFQlNS7kAktflK7aD+vH/XJwPzxsNH4rVyVn0=
// > Chave AES criptografada com RSA: oDVjASU5AOievA3ipRH9rTTNNRGbtT7Agdyon/44nc4RQVIDuxIqhmNGZ5HWEEgsiqtmArVsq9BRiOj1V7QOjOEgZ/smBXhtwC9P5GD9StR3wmmVa0U8eANUVviPiUdjXZcK30qDaocnwqu5AyI1qhMX3RIpidNcxqhq/IaUAwsh4eRRRnhs0vGKatLhja2l4MkOXnURxaVx9r9XWE7dXVqqIWyykfI8/N2hh8v0TYwjjAd+Y1l8FK1rJzfC5jvsM+v7gSeN02CcWFPaK/yMktUUG5MzaJyiTg+puMRAXuZv24x/U4Ai4YSbTKmdzXCltNPK2a3viA5VvamUjsOTvhuUgS0SyV+MEFty4VRGzhCNXuT76UTbmu6AXTf/7PH07Ah8McOt3Z4rsbhJilAta+PBcHiK5wzjYpsY2Hb87yTCs9EK8oYnMJlyBAZoRiBgt/9HMq6uqMqtfSLXradOZ5ikEWgf1GzV+okSUXKYBGhgvIliS9lVzQgaceAA9rOg
// > Assinatura criptografada com AES: /K9vrVVM9Dmujjl0svG1wngKzJpUjLOkoghC43dQ1zxSttwiqeDNTQ4lWUnRdLUnFP8sEbyaZ0sJHxa6kFr6Tyi82wwbAUAiZKa1T+0OMIFwwgAM3bC5YiAmySY6dikC2XCw0ZNWIJWpoXR2QPGY8YsVov8+P7cflAf8lFObaRqpGiJDLL0a5Z6eWO8JH5jzGG+/YR0TYCA6zj//WJvEV2j3TfSo5WslO2+SZz1iELNnREVyXtJ4TR3kIqmZwWaTR1ytiWxkRxl4sQhtbvuuBaprmdWg3HDXo9eusTrXhmGAQ8CFz5+g9SFY3NTXjS/BrXVtUBVv40xsD8zNqEOfPzcVNQGQXnz2+6qFH6g/2p02/1JFWRjVPaZJ2WYqOzwj8shJGOD9hoS7r8/sFvgQnXw8KVWLqgTX+ji+8TOtjKxpzkFyLOz5+GZaBw5Hzylzv571XZnkgL9eWiPVIi6c5bLv1qSkTGAgqYJq572dgB54IVKUIe6maDDfHZvfzkxiKtU1O5a1927nClTO0uYwGObXGSmt9qxyaYrLgptVCACqf+dggZzu0/lSCmBsz3Fz79lkPH783ILy0JmFaF9rM2JWOFg62IHrfpoXdCXPA1+DuR/btvVCUhkvW8T0Wj5I9FWO9oU48JEpu2+GVnKYYxLqtdspqgr261kQNYQeFk1x4hfMOY9D6W1UVK+PNqKZ
// > Chave pública do cliente criptografada: 72hZ4BaTDiUDj8CYFdGj1na/GuWz+8OvKL8R5pG3LWWJDumcX2L+1k6bWLjJnwiXg0zgzD6pnDkIXKGh1kvqv1hmEPEuZdHD5oDbyPtMpGxBmaBNR+mxtfqv6rWfpfePVRX8NN4+cK/fLFjUZBGxTuqr8lZUMzjyTY2O1Js2Qc7L+SjHfAfDkLCVr80M3nys6555eTkdd47q1EcyEZDY20h1bo5qoLefdEwBKW18HW+sBm4A9VZ8WOnBbzEXusKzlpbKy/7bEZT+zhojAa31a0LJnn31DqCFMwQqYE52bONeWU+NMXlk8XPTWTeCiHh8zoLidd7FRQc2+eYFm5tRqTFUGxvzNfLgS6GNJPyfnV7vbX0/YYs3MklkpQ0HLHe/l2bK/W5llNuE/T6M+Zik1zdevtXIxYhhP+GbnnahhGIkTDtmhk1Xr9LLZ//pmWYc42DLA7ddVwyeAAki3Eih6R2nQ7WXdcTh2hfCuPHVTUH9GWK8cEZ4Mh5qKAjeMuahRLpuKLh1wScRPdS7wpIc0VaGNyjmQv5RyaugFw4B2TqMPd0/wemUsfxWc2f79vPN590u/vtJJOXauyzG8C8CXAJo2ASOkssQmT0mJt3d87Y2+hvVaeIlhIhyQPQ6bhZoSSsGLdI6f26wV0Au6NxU03uI9wOhzkDX94y6IOqQB1d0QTMqkYTV7q+yS4vivdzT1wJEKedUyWMCJ2o5WOzS6+R3bbVbw1Vr5kCN3uRzEE8cZ6U7YT6/AHAyhNBcbV1L
// > Formato dos dados: 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

import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;
import java.security.*;
import java.util.Base64;
import java.security.spec.X509EncodedKeySpec;
import java.security.spec.PKCS8EncodedKeySpec;


public class Main {

    static KeyPair rsaMasterKeyPair;
    static KeyPair rsaClientKeyPair;
    static PublicKey publicKeyMaster;
    static PrivateKey privateKeyMaster;
    static PublicKey publicKeyClient;
    static PrivateKey privateKeyClient;

    static {
        try {
            // Chave RSA master fornecida em Base64 (em um ambiente real, isso seria uma chave real)
            String base64MasterPublicKey = "MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEArLA9rcHRjIG2vNTJmS3zMBgYEkuJMZCrpRUCstBK48Uwdp+1zNxxj81e/XLayN8dD8qNIusWckgyUGDTM4LNv+XdKCVgQaDV0jOeIfJqYFK6cPGf2UsDfcWUwpNi/UChv8HD9QI+qglxumYJuY/ttaOrxMUEhnIcnBMgcHb3P+dlsx1VrNfz3oh1UwqrYVglgy1w0sNeNVvOLIjuxbDPnq2wh5dnC+GogxXdB4TXQdeXzOB8gp3Cbc4CW9aycIRnyrrV9ywBaosulgUKwDvtHXk8YjhnyNyviwnoRA4TLnraFTET/BuqaR9sJ1FJ85UNGF+ElAp0u4e354NvPId0oaamaQhGL8xL3aAJgOCmto3xi5Tar7OGJ5WTGzxtAmOcqps3skXFYVcM9KFy19oFymTHkvu556sP648zSTr+jXGO+a1A7SXWv2cEpv3RrqOR8+UQkKRl9ldxKGZ8ePQ4m7etzFxuljYJl08k77q41s9a+HFdYa7qn9Rz+o5OrsG7AgMBAAE=";
            // Convertendo as chaves de Base64 para Key objects
            byte[] publicKeyBytes = Base64.getDecoder().decode(base64MasterPublicKey);
            KeyFactory keyFactory = KeyFactory.getInstance("RSA");

            publicKeyMaster = keyFactory.generatePublic(new X509EncodedKeySpec(publicKeyBytes));
            
            // Gerando as chaves do cliente
            rsaClientKeyPair = generateRSAKey();
            publicKeyClient = rsaClientKeyPair.getPublic();
            privateKeyClient = rsaClientKeyPair.getPrivate();
            
        } catch (Exception e) {
            e.printStackTrace();
            throw new RuntimeException("Erro ao inicializar as chaves RSA");
        }
    }

    // Gerar chave RSA
    public static KeyPair generateRSAKey() throws Exception {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(3072);
        return keyPairGenerator.generateKeyPair();
    }

    // Criptografar com RSA
    public static String encryptRSA(SecretKey aesKey, PublicKey rsaPublicKey) throws Exception {
        Cipher cipher = Cipher.getInstance("RSA/ECB/OAEPWithSHA-256AndMGF1Padding");
        cipher.init(Cipher.ENCRYPT_MODE, rsaPublicKey);
        byte[] encryptedAESKey = cipher.doFinal(aesKey.getEncoded());
        return Base64.getEncoder().encodeToString(encryptedAESKey);
    }

    // Descriptografar com RSA
    public static SecretKey decryptRSA(String encryptedAESKey, PrivateKey rsaPrivateKey) throws Exception {
        Cipher cipher = Cipher.getInstance("RSA/ECB/OAEPWithSHA-256AndMGF1Padding");
        cipher.init(Cipher.DECRYPT_MODE, rsaPrivateKey);
        byte[] decodedEncryptedAESKey = Base64.getDecoder().decode(encryptedAESKey);
        byte[] decryptedAESKey = cipher.doFinal(decodedEncryptedAESKey);
        return new SecretKeySpec(decryptedAESKey, "AES");
    }

    // Gerar chave AES
    public static SecretKey generateAESKey() throws Exception {
        KeyGenerator keyGenerator = KeyGenerator.getInstance("AES");
        keyGenerator.init(256);
        return keyGenerator.generateKey();
    }

    // Criptografar com AES
    public static String encryptAES(String data, SecretKey key) throws Exception {
        Cipher cipher = Cipher.getInstance("AES");
        cipher.init(Cipher.ENCRYPT_MODE, key);
        byte[] encryptedData = cipher.doFinal(data.getBytes());
        return Base64.getEncoder().encodeToString(encryptedData);
    }

    // Descriptografar com AES
    public static String decryptAES(String data, SecretKey key) throws Exception {
        Cipher cipher = Cipher.getInstance("AES");
        cipher.init(Cipher.DECRYPT_MODE, key);
        byte[] decodedData = Base64.getDecoder().decode(data);
        byte[] decryptedData = cipher.doFinal(decodedData);
        return new String(decryptedData);
    }

    // Assinar dados com a chave privada RSA
    public static String signData(byte[] data, PrivateKey privateKey) throws Exception {
        Signature signature = Signature.getInstance("SHA256withRSA");
        signature.initSign(privateKey);
        signature.update(data);
        byte[] signedData = signature.sign();
        return Base64.getEncoder().encodeToString(signedData);
    }

    // Verificar assinatura
    public static boolean verifySignature(byte[] data, String signatureStr, PublicKey publicKey) throws Exception {
        Signature signature = Signature.getInstance("SHA256withRSA");
        signature.initVerify(publicKey);
        signature.update(data);
        byte[] signatureBytes = Base64.getDecoder().decode(signatureStr);
        return signature.verify(signatureBytes);
    }

    // Imprimir mensagens
    public static void print(String text) {
        System.out.println(text);
    }

    // Função principal
    public static void main(String[] args) {
    try {
        // Gerar chave AES e criptografar dados
        SecretKey aesKey = generateAESKey();
        String data = "Informação confidencial";

        // Assinar a mensagem
        String signature = signData(data.getBytes(), privateKeyClient);
        print(" > Assinatura gerada: " + signature);
        print(" > Chave AES gerada: " + Base64.getEncoder().encodeToString(aesKey.getEncoded()));

        // Criptografar os dados com AES
        String encryptedData = encryptAES(data, aesKey);
        print(" > Dados criptografados com AES: " + encryptedData);

        // Criptografar a chave AES com RSA
        String encryptedAESKey = encryptRSA(aesKey, publicKeyMaster);
        print(" > Chave AES criptografada com RSA: " + encryptedAESKey);

        // Criptografar a assinatura com AES
        String encryptedSignature = encryptAES(signature, aesKey);
        print(" > Assinatura criptografada com AES: " + encryptedSignature);

        // Serializar e criptografar chave pública do cliente
        String serializedPublicKeyClient = Base64.getEncoder().encodeToString(publicKeyClient.getEncoded());
        String encryptedPublicKeyClient = encryptAES(serializedPublicKeyClient, aesKey);
        print(" > Chave pública do cliente criptografada: " + encryptedPublicKeyClient);

        // Simulação de envio
        print(" > Formato dos dados: " + encryptedSignature + "," + encryptedAESKey + "," + encryptedData + "," + encryptedPublicKeyClient);

    } catch (Exception e) {
        e.printStackTrace();
    }
}}
